services:
  cowrie:
    image: cowrie/cowrie:latest
    container_name: cowrie
    restart: always
    ports:
      - "2222:2222"   # SSH honeypot
      - "2223:2223"   # Telnet honeypot
    environment:
      COWRIE_USER: cowrie
      COWRIE_GROUP: cowrie
    command: >
      bash -c "if [ ! -f /cowrie/cowrie-git/var/log/cowrie.json ]; then
                 echo 'üõ†Ô∏è First-time setup: initializing Cowrie...';
                 cp -r /cowrie/cowrie-git/etc.dist /cowrie/cowrie-git/etc &&
                 cp -r /cowrie/cowrie-git/var.dist /cowrie/cowrie-git/var;
               fi &&
               /cowrie/cowrie-env/bin/twistd -n cowrie"

  cowrie-log-forwarder:
    build: ./log_forwarder
    container_name: cowrie-log-forwarder
    restart: always
    depends_on:
      - cowrie
    environment:
      - N8N_WEBHOOK_URL=https://n8n.samvivan.my.id/webhook-test/10e4c630-6bce-4038-8777-916fba8bdc28
    volumes:
      - cowrie_logs:/logs

volumes:
  cowrie_logs:
    name: cowrie_logs
